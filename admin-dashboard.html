<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASQ | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>

  <style>
    :root{--blue-dark:#0b3a70;--blue:#1565c0;--orange:#ff7a1a;--bg:#f7f9fc;--text:#0f172a;--card:#fff;--shadow:0 10px 25px rgba(0,0,0,.07);}
    body{margin:0;font-family:"Cairo",sans-serif;background:var(--bg);color:var(--text)}
    .container{max-width:1000px;margin:40px auto;padding:20px}
    h1{color:var(--blue-dark);margin-bottom:10px}
    p{color:#64748b}

    table{width:100%;border-collapse:collapse;margin-top:20px;background:var(--card);border:1px solid #e5e7eb;box-shadow:var(--shadow);border-radius:10px;overflow:hidden}
    table thead{background:var(--blue-dark);color:#fff}
    th,td{padding:12px;border-bottom:1px solid #edf2f7;text-align:right;font-size:.95rem}
    tbody tr:hover{background:#f1f5f9}
    .empty-msg{padding:14px;background:#fff3cd;border:1px solid #ffeeba;color:#856404;margin-top:20px;border-radius:8px;text-align:center}

    .logout-btn{display:inline-block;margin-top:16px;padding:10px 18px;border-radius:8px;background:#dc2626;color:#fff;font-weight:700;text-decoration:none;cursor:pointer}
  </style>
</head>

<body>
  <div id="asq-header"></div>

  <main>
    <div class="container">
      <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø´Ø±Ù</h1>
      <p>Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©.</p>

      <div id="dataArea"></div>

      <a id="logoutBtn" class="logout-btn">ğŸ”“ ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
    </div>
  </main>

  <div id="asq-footer"></div>

  <!-- âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„ÙÙˆØªØ± -->
  <script>
    (function(){
      const load = (id, file, cb) => fetch(file)
        .then(r => r.text())
        .then(h => {
          document.getElementById(id).innerHTML = h;
          if (typeof cb === "function") cb();
        });

      load('asq-header', './header.html');
      load('asq-footer', './footer.html');
    })();
  </script>

  <!-- âœ… Firebase Auth + Firestore -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } 
      from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
    import { getFirestore, collection, getDocs } 
      from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCz8cp81HkT_tMiSZ3DqfHGeG8jEjQday8",
      authDomain: "asq-booking-system.firebaseapp.com",
      projectId: "asq-booking-system",
      storageBucket: "asq-booking-system.appspot.com",
      messagingSenderId: "564650359611",
      appId: "1:564650359611:web:cfd1f48f7a5c52d9a6951e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const dataArea = document.getElementById("dataArea");
    const logoutBtn = document.getElementById("logoutBtn");

    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "admin-login.html"; // â›” ØºÙŠØ± Ù…ØµØ±Ø­ â†’ ÙŠØªÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
      } else {
        loadBookings(); // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¯Ø®ÙˆÙ„
      }
    });

    // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ù† Firestore
    async function loadBookings(){
      const querySnapshot = await getDocs(collection(db, "bookings"));

      if (querySnapshot.empty){
        dataArea.innerHTML = `<p class="empty-msg">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>`;
        return;
      }

      // Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
      let tableHTML = `
        <table>
          <thead>
            <tr>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th>
              <th>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø²</th>
              <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</th>
              <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
              <th>ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
            </tr>
          </thead>
          <tbody>
      `;

      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const date = data.createdAt?.toDate().toLocaleString('ar-EG') || 'ØºÙŠØ± Ù…ØªØ§Ø­';

        tableHTML += `
          <tr>
            <td>${data.name}</td>
            <td>${data.phone}</td>
            <td>${data.type}</td>
            <td>${data.date}</td>
            <td>${data.note || '-'}</td>
            <td>${date}</td>
          </tr>
        `;
      });

      tableHTML += `</tbody></table>`;
      dataArea.innerHTML = tableHTML;
    }

    // âœ… Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "admin-login.html";
    });
  </script>

</body>
</html>
